#+TITLE: 小说相关脚本说明
#+DESCRIPTION: 关于构建部分小说资源页面用到的脚本和生成latex缩印文件脚本的说明
#+DATE: <2026-01-03 六 05:54>
#+SETUPFILE: ../../setup.setup

* 简介
所有程序均存放在[[./../../lib/python/]]即submodule里。下面逐个介绍：
- [[./../../lib/python/split_novel.py][split_novel.py]]:
  根据配置，按卷分割合集式txt小说文件排成org文件（用于构造org文件用）
- [[./../../lib/python/merge2tex.py][merge2tex.py]]:
  根据配置，将org文件合并成一个使用了缩印模板的tex文件以用xelatex生成pdf文件进行打印

* 食用方法
1. 克隆整个仓库（包括submodule）
2. 生成org文件树：
   1. 下载好一个符合要求的txt文件（例如[[./无职/无职转生～到了异世界就拿出真本事～.txt][无职的这个文件]]）
   2. 使用split_novel.py生成默认的配置json文件：
      #+begin_src shell
        split_novel.py -C > 目标文件.json
      #+end_src
   3. 根据实际情况删除保持默认配置的选项并编辑需要更改的配置使程序能恰当地分割章
      节文件，以及设置字符串替换列表将不同译名或者错字、繁体字统一替换，例如
      #+begin_src json
        {
        	"source_file": "./无职转生～到了异世界就拿出真本事～.txt",
        	"title": "无职转生",
        	"comment": "",
        	"words": [
        		[ "鲁迪鸟斯", "鲁迪乌斯" ],
        		[ "卢迪", "鲁迪" ],
        		[ "洛克希", "洛琪希" ],
        		[ "艾丽丝", "艾莉丝" ],
        		[ "米格尔多", "米格路德" ],
        		[ "瑞杰尔德", "瑞杰路德" ],
        		[ "奥尔斯蒂德", "奥尔斯帝德" ],
        		[ "爱莎", "爱夏" ],
        		[ "艾丽娜莉兹", "艾莉娜丽洁" ],
        		[ "莉兹", "丽洁" ],
        		[ "基司", "基斯" ],
        		[ "飞利浦", "菲利普" ],
        		[ "艾丽爱尔", "爱丽儿" ],
        		[ "阿苏拉", "阿斯拉" ],
        		[ "格瑞拉特", "格雷拉特" ],
        		[ "身分", "身份" ],
        		[ "计画", "计划" ],
        		[ "徵", "征" ],
        		[ "乾", "干" ]
        	]
        }
      #+end_src
   4. 指定配置文件运行程序：
      #+begin_src shell
        split_novel.py -c 目标文件.json
      #+end_src
      如果没有问题那应该会生成一堆org文件：
      #+begin_src text
        .
        ├── 001_第一卷 幼年期.org
        ├── 002_第二卷 少年期 家庭教师篇.org
        ├── 003_第三卷 少年期 冒险者入门篇.org
        ├── 004_第四卷 少年期冒险者入门篇.org
        ├── 005_第五卷 少年期 再会篇.org
        ├── 006_第六卷 少年期 归乡篇.org
        ├── 007_第七卷 青少年期 中坚冒险者篇.org
        ├── 008_第八卷 青少年期 学园篇（前）.org
        ├── 009_第九卷 青少年期 学园篇（后）.org
        ├── 010_第十卷 青少年期 新婚篇.org
        ├── 011_第十一卷 青少年期 妹妹篇.org
        ├── 012_第十二卷 青少年期 迷宫篇.org
        ├── 013_第十三卷 青少年期 日常篇.org
        ├── 014_第十四卷 青少年期 召唤篇.org
        ├── 015_第十五卷 青少年期 人神篇.org
        ├── 016_第十六卷 青年期 阿斯拉王国篇（前）.org
        ├── 017_第十七卷 青年期 阿斯拉王国篇（后）.org
        ├── 018_第十八卷 青年期 部下篇.org
        ├── 019_第十九卷 札诺巴篇.org
        ├── 020_第20.5卷 web版.org
        ├── 021_第二十一卷 青年期 克里夫篇 web版.org
        ├── 022_第二十二卷 组织编 web版.org
        ├── 023_第二十三卷 青年期 决战篇 web版.org
        ├── 024_第二十四卷 完结编 web版.org
        ├── config.json
        └── 无职转生～到了异世界就拿出真本事～.txt

        1 directory, 26 files
      #+end_src
3. 生成tex文件：
   1. 使用merge2tex.py生成默认的配置json文件：
      #+begin_src shell
        merge2tex.py -C > 目标文件.json
      #+end_src
   2. 根据实际情况删除保持默认配置的选项并编辑需要更改的配置(诸如标题、作者、纸
      张类型、字号、输入目录、黑白名单等)例如:
      #+begin_src json
        {
        	"title": "无职转生",
        	"author": "(原作:不讲理不求人（理不尽な孫の手）)",
        	"setting": {
        		"papersize": "b5paper"
        	},
        	"filelist": {
        		"../无职/": {
        			"ignore": [
        				"./index.org",
        				"./027_蛇足篇web版补全.org"
        			],
        			"add": [
        				"./027_蛇足篇web版补全.org::25716"
        			]
        		}
        	}
        }
      #+end_src
      文件名后面加上 =::num1-num2= 表示只选取num1行到num2行的部分内容（省略num2
      意味着选到最后）

      如果使用默认配置请确保拥有 *等线Light* 字体（Windows自带）(，打印出来相对
      清晰且包含的字符多)
   3. 运行merge2tex.py并指定特定配置文件：
      #+begin_src shell
        ./merge2tex.py -i 目标文件.json
      #+end_src
      输出结果类似：
      #+begin_src text
        [INFO] Config:
        {'author': '(原作:不讲理不求人（理不尽な孫の手）)',
         'filelist': {'../无职/': {'add': ['./027_蛇足篇web版补全.org::25716'],
                                 'ignore': ['./index.org', './027_蛇足篇web版补全.org']}},
         'output': 'output_#${title}_#${setting.papersize}_#${setting.fontsize}pt_#${template.gtst}.tex',
         'setting': {'border': {'bindingoffset': 0.9,
                                'bottom': 0.9,
                                'footskip': 6.9,
                                'left': 0.7,
                                'right': 0.7,
                                'top': 0.5},
                     'col_gap': '1mm',
                     'cols': 9,
                     'fontname': 'DengXian Light',
                     'fontsize': 4,
                     'gen_info': True,
                     'mktitle': True,
                     'mktoc': True,
                     'papersize': 'b5paper',
                     'ruler': False,
                     'toc_cols': 5},
         'title': '无职转生'}
        [INFO] searching '../无职'
        [INFO] filelist:
               - ../无职/001_第一卷 幼年期.org
               - ../无职/002_第二卷 少年期 家庭教师篇.org
               - ../无职/003_第三卷 少年期 冒险者入门篇.org
               - ../无职/004_第四卷 少年期冒险者入门篇.org
               - ../无职/005_第五卷 少年期 再会篇.org
               - ../无职/006_第六卷 少年期 归乡篇.org
               - ../无职/007_第七卷 青少年期 中坚冒险者篇.org
               - ../无职/008_第八卷 青少年期 学园篇（前）.org
               - ../无职/009_第九卷 青少年期 学园篇（后）.org
               - ../无职/010_第十卷 青少年期 新婚篇.org
               - ../无职/011_第十一卷 青少年期 妹妹篇.org
               - ../无职/012_第十二卷 青少年期 迷宫篇.org
               - ../无职/013_第十三卷 青少年期 日常篇.org
               - ../无职/014_第十四卷 青少年期 召唤篇.org
               - ../无职/015_第十五卷 青少年期 人神篇.org
               - ../无职/016_第十六卷 青年期 阿斯拉王国篇（前）.org
               - ../无职/017_第十七卷 青年期 阿斯拉王国篇（后）.org
               - ../无职/018_第十八卷 青年期 部下篇.org
               - ../无职/019_第十九卷 札诺巴篇.org
               - ../无职/020_第20.5卷 web版.org
               - ../无职/021_第二十一卷 青年期 克里夫篇 web版.org
               - ../无职/022_第二十二卷 组织编 web版.org
               - ../无职/023_第二十三卷 青年期 决战篇 web版.org
               - ../无职/024_第二十四卷 完结编 web版.org
               - ../无职/025_蛇足篇1.org
               - ../无职/026_蛇足篇2.org
               - ../无职/027_蛇足篇web版补全.org [25716]
                 > ** 爱夏辞去女仆之时
                 > *** 「童话」
                 > 翻译：urishino
                 > 
                 > 很久很久以前，有位名叫亚尔斯的少年。
               - ../无职/999_非正文内容.org
        [INFO] 输出文件为'output_无职转生_b5paper_4pt_20260111_132120.tex'
      #+end_src

* 效果
#+caption: 上述命令输出的效果
[[./latex/res/example1.webp]]
#+caption: 关键交界处及页脚展示
[[./latex/res/example2.webp]]
